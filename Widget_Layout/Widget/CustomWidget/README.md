# 사용자 정의 위젯

사용자 정의 위젯은 **QWidget** 클래스를 직접 상속받아서 위젯을 생성하는 방법으로 생성자와 관련 메소드들을 이용해서 위젯의 모양과 기타 사항들을 설정할 수 있다.
사용자 정의 위젯(Custom Widget)을 사용하기 위해서는 새로울 위젯 클래스를 생성해야 한다.

헤더 파일(***customwidget.h***)에는 **QWidget** 클래스를 상속받는 사용자 정의 클래스를 정의하였고, 생성자를 추가하였다. 생성자의 인자로는 부모 클래스를 지정할 수 있도록 **QWidget** 타입의 인자를 추가하였다.

사용자 정의 위젯의 소스 코드(***customwidget.cpp***)는 헤더 파일에서 정의한 생성자에 대한 내용을 처리한다. **QPushButton** 위젯의 객체에 대해서 별도의 창을 여는 것이 아니라, 사용자 정의 위젯 안에 위치하고 있어야 하므로 **QPushButton** 객체의 부모로 현재 클래스를 의미하는 **this**를 지정하였다.

사용자 정의 위젯의 크기를 조정하고 싶은 경우데오 마찬가지로 **QWidget** 클래스의 매소드를 사용할 수 있고, 여기에 현재 클래스를 의미하는 **this** 지시어를 사용할 수 있는데, **this** 지시어는 생략해도 된다.

**QPushButton** 클래스의 **clicked()** 시그널과 **QApplication** 클래스의 **quit()** 슬롯을 연결해야 하는데, **main()**함수와는 다르게 사용자 정의 클래스의 생성자에는 **QApplication** 클래스의 객체(인스턴스)가 없기 때문에 바로 연결할 수 없다. **Qt**에서는 일반적으로 **QApplication** 클래스의 객체는 **main()**함수에서 선언된다. 이 객체를 다른 위치에서 사용하려면 조금 복잡한 작업이 필요한데, 이러한 처리를 보다 쉽게할 수 있도록 **Qt**는 별도의 **qApp**라는 글로벌 인스턴스를 제공한다. 이 인스턴스를 이용해서 시그널과 슬롯은 연결하면 된다.

+ **qApp**은 현재 실행 중인 **QApplication** 객체를 가리키는 전역 포인터다.

***main.cpp*** 를 보면 **QApplication** 클래스의 객체를 생성한 후 사용자 정의 위젯을 만들어서 사용하였다.

# 사용자 정의 시그널과 슬롯

기본적으로 슬롯은 시그널이 발생했을 때 처리하는 코드이기 때문에 **Qt**에서 제공하는 기본 슬롯만 가지고는 프로그래밍을 하기 어렵다.

**Qt** 프로개르밍을 하기 위해서는 사용자 정의 슬롯을 만드는 방법을 알아야 하며, 이를 위해서는 **QObject** 클래스에 대해 보다 자세히 알아야 한다. Qt의 시그널과 슬롯은 **QObject**클래스를 상속받는 클래스 내에서만 사용이 가능하고, 사용자 정의 시그널과 슬롯을 사용하기 위해서는 별도이 선언이 필요하다.

***customwidget.h***을 보면 클래스 선언부 아래에 **Q_OBJECT**라는 매크로를 이용해서 현재 클래스가 사용자 정의 시그널과 슬롯을 사용한다고 명시해줘야 한다. 시그널과 슬롯은 **C++** 프로그래밍 언어에서 제공해주는 개념이 아니기 때문에 이를 처리하기 위한 별도의 코드가 필요하다. **Qt**에서는 이를 메타 오브젝트 코드(Meta-Object Code)라고 부르고, 이를 위한 **moc**라고 부르는 컴파일러를 제공한다. 사용자 정의 시그널이나 슬롯을 사용하기 위해서는 **qmake** 명령어를 다시 수행해서 **moc** 명령어가 사용되도록 **Makefile**을 재생성한다.

사용자 정의 시그널을 사용할 때 '**signals:**'라는 지시어 아래에 선언하면, **moc** 명령어에 의해서 자동으로 관련 코드가 생성되므로 별도의 구현이 필요하지 않다. 사용자 정의 슬롯을 사용할 때는 접근 지정자(public, private, protected)와 함께 '**slots:**'라는 지시어 아래에 선언하고, 일반 메소드를 구현하듯 **.cpp** 파일 안에 구현한다.

***customwidget.cpp***를 보면 **QPushButton** 클래스의 시그널과 현재 클래스의 슬롯을 연결하였다. 사용자 정의 슬롯을 사용하고 있는 경우에 세 번째 인자로 **this**를 사용하는데 이 경우에 세 번째 인자는 생략될 수 있다. 사용자 정의 슬롯에서 사용자 정의 시그널을 발생시켰는데, 시그널이 일반 메소드가 아니므로 호출하는 것이 아니라 **emit** 지시어를 사용하면 된다.

#### ***시그널 포워딩(Signal Forwarding)***
+ 시그널에서 사용자 정의 슬롯을 호출한 후, 슬롯에서 시그널을 다시 발생하는 경우에는 아래와 같이 시그널과 시그널을 바로 연결할 수 있다.
```cpp
connect(button, SIGNAL(clicked()), SIGNAL(widgetClicked()));
```
+ 시그널 포워딩을 이용하면 사용자 정의 슬롯을 만들지 않아도 되기 때문에 편리하다.

***main.cpp***를 보면 **QApplication** 클래스의 **quit()** 슬롯을 연결한 후 코드를 빌드해서 실행하보면 앞에서 설명한 것과 같이 코드를 빌드하기 전에 반드시 '**qmake**' 유틸리티를 통해서 **makefile**을 다시 생성해야 한다.

+ ***실행 결과***<br>
![customwidget](https://github.com/user-attachments/assets/c4347684-9786-49ff-90ae-448a05fccd0e)

**Qt connect()**는 2번째 인자 (시그널 함수)의 매개변수와 번째 인자 (슬롯 함수)의 매개변수는 일치하거나, 슬롯이 시그널 매개변수보다 적거나 타입 호환 가능해야 한다.
+ 시그널 매개변수 → 슬롯 매개변수로 자동으로 값이 전달된다고 보면 된다.
+ 슬롯은 시그널 매개변수의 일부만 받을 수도 있음 (예: 시그널이 (int, QString)인데 슬롯이 (int)만 받음)
+ 타입은 완전히 동일하거나, 암묵적 변환 가능한 타입이어야 에러 없이 연결됨.